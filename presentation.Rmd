---
title: "Labor Force Participation"
author: "Justin M. Shea"
date: "September 12, 2017"
output: beamer_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(knitr)
library(rmarkdown)
library(xts)
library(ggplot2)
library(blscrapeR)
library(tidyr)
library(ggthemes)
library(tufte)

source("functions.R")
```

## Introduction

The percentage of people participating in the labor force remains depressed since the Great Recession. So too, does aggregate demand.

## Unemployment, headline percentage looks fine


```{r, message=FALSE}
# Employment Statistics
Unemployment_url <- "https://fred.stlouisfed.org/data/UNRATE.txt"

Unemployment <- as.xts(read.zoo(Unemployment_url, skip = 24, index.column = 1, 
                            header = TRUE, format = "%Y-%m-%d", FUN = as.yearmon))

autoplot(Unemployment["1980/"]) + theme_bw()

```

## The labor participation rate, doesn't.

```{r, message=FALSE}
labor_participation_url <- "https://fred.stlouisfed.org/data/CIVPART.txt"


labor_participation <- as.xts(read.zoo(labor_participation_url, skip = 14, index.column = 1, 
                                   header = TRUE, format = "%Y-%m-%d", FUN = as.yearmon))

autoplot(labor_participation["1980/"]) + theme_bw()

```

## The labor participation rate, by age

```{r}
#bls data by ages
library(blscrapeR)
library(tidyr)
library(tufte)

employment_series <- c("LNS11324230", "LNS11300093", "LNS11300091", "LNS11300089", "LNS11324887" )

labels <- c("55 and over", "45 to 55", "35 to 44", "25 to 34", "16 to 24")

employment_ages <- bls_api(employment_series, startyear = 2000, endyear = 2017, registrationKey = Sys.getenv("BLS_KEY")) %>% 
        dateCast()

employment_wide <- employment_ages %>% spread(seriesID, value)

  ggplot(employment_wide, aes(x=date)) +
        geom_line(aes(y=LNS11324230)) +
        geom_line(aes(y=LNS11300093)) +
        geom_line(aes(y=LNS11300091)) +
        geom_line(aes(y=LNS11300089)) +
        geom_line(aes(y=LNS11324887)) +
        theme_bw()

```

## Output gap

```{r, message=FALSE, warning=FALSE}
Real_GDP_URL <- "https://research.stlouisfed.org/fred2/data/GDPC96.txt"
Real_GDP <- as.xts(read.zoo(Real_GDP_URL, skip = 12, index.column = 1, 
                        header = TRUE, format = "%Y-%m-%d", FUN = as.yearqtr))

HL_GDP_actual <- HLfilter(Real_GDP, h = 64)

Gap_Percent <- 100 * (sum(HL_GDP_actual["2017"]$HL_resid) / sum(HL_GDP_actual["2017"]$x_h))
#kable(Gap_Percent)

# log real gdp for plots
Hlm_GDP <- HLfilter.lm(Real_GDP["/2007"], h = 80)
HL_GDP <- HLfilter(100*log(Real_GDP), h = 40)


# plot GDP
#plot(HL_GDP$HL_fit, col = "red", grid.col = "white")
#lines(HL_GDP$x_h, col = "black")

plot(HL_GDP$HL_fit["1984/"], col = "red", grid.col = "white")
lines(HL_GDP$x_h["1984/"], col = "black")
```

## Output gap
```{r, message=FALSE, warning=FALSE}
# plot resid
plot(HL_GDP$HL_resid["1956/"], index(employ_hlf), col = "black", grid.col = "white")
abline(v = .index(HL_GDP["2001"])[1], lty = 2, col = "green")
abline(v = .index(HL_GDP["2009"])[1], lty = 2, col = "red")
#abline(h = 415, lty = 2, col = "green")
abline(h = 0, lty = 2, col = "black")
#abline(h= -515, lty = 2, col = "red")
```


## Government Spending
```{r, message = FALSE, warning = FALSE, tidy = TRUE}
### Government Consumption Expenditures
                        Federal_GCE <- "https://fred.stlouisfed.org/data/FGCE.txt"
                    State_Local_GCE <- "https://fred.stlouisfed.org/data/SLCE.txt"
                    
## GCE Quantity & Price Indexes
Federal_Quantity_Index <- "https://fred.stlouisfed.org/data/B823RA3Q086SBEA.txt"
        Federal_Price_Index <- "https://fred.stlouisfed.org/data/B823RG3Q086SBEA.txt"
#-------------------------------------#
State_Local_Quantity_Index <- "https://fred.stlouisfed.org/data/B829RA3Q086SBEA.txt"
        State_Local_Price_Index <- "https://fred.stlouisfed.org/data/B829RG3Q086SBEA.txt"
        
GCE_Table <- t(data.frame(Federal_GCE, Federal_Quantity_Index, Federal_Price_Index, State_Local_GCE, State_Local_Quantity_Index, State_Local_Price_Index))
#kable(GCE_Table, align = "l", caption = "GCE Nominal, Quantity, and Price index sources.")
```

```{r, message = FALSE, warning = FALSE, tidy = TRUE}
Federal          <- as.xts(read.zoo(Federal_GCE, sep = "", skip = 13, 
                           index.column = 1,  header = TRUE, format = "%Y-%m-%d", FUN = as.yearqtr))
Federal_Quantity <- as.xts(read.zoo(Federal_Quantity_Index, sep = "", skip = 13, 
                           index.column = 1,  header = TRUE, format = "%Y-%m-%d", FUN = as.yearqtr))
Federal_Price    <- as.xts(read.zoo(Federal_Price_Index  , sep = "", skip = 13, 
                           index.column = 1,  header = TRUE, format = "%Y-%m-%d", FUN = as.yearqtr))
#------------------------------# 
State_Local          <- as.xts(read.zoo(State_Local_GCE, sep = "", skip = 13, 
                              index.column = 1,  header = TRUE, format = "%Y-%m-%d", FUN = as.yearqtr))
State_Local_Quantity <- as.xts(read.zoo(State_Local_Quantity_Index, sep = "", skip = 13, 
                              index.column = 1,  header = TRUE, format = "%Y-%m-%d", FUN = as.yearqtr))
State_Local_Price    <- as.xts(read.zoo(State_Local_Price_Index  , sep = "", skip = 13, 
                              index.column = 1,  header = TRUE, format = "%Y-%m-%d", FUN = as.yearqtr))
```


```{r message = FALSE, warning = FALSE, tidy = TRUE}
Real_Federal      <- Fisher(Federal, Federal_Price, Federal_Quantity, 249)
Real_State_Local  <- Fisher(State_Local, State_Local_Price, State_Local_Quantity, 249)
```

```{r message = FALSE, warning = FALSE, fig.fullwidth = TRUE, fig.cap = "Real Federal and Local Spending, 1980-Present"}
library(ggplot2)
library(RColorLisa)

Government <- merge(Real_Federal, Federal, Real_State_Local, State_Local)

Picasso <- color.lisa.pal(5, "The Dream by Pablo Picasso")
Basquiat <- color.lisa.pal(4, "DUSTHEADS by Jean-Michel Basquiat")
vanGogh <- color.lisa.pal(4, "The Starry Night by Vincent van Gogh")
chagall <- color.lisa.pal(4, "La MariÃ©e sous le Baldaquin by Marc Chagall")

autoplot(Government["1980/"], facets = Series ~., melt=TRUE, ncol=2) +
        scale_y_continuous(position = "right") +
        geom_vline(xintercept = c(1990, 1994, 2002, 2010)) +
        scale_color_manual(values = Picasso) +
        theme_bw()+ theme(legend.position = "top")

```

```{r}
# GDP
GDP_and_Gov <- merge(Real_GDP, Real_Federal, Federal, Real_State_Local, State_Local)
Government_table <- data.frame(coredata(GDP_and_Gov ["2010/"]))
rownames(Government_table) <- index(GDP_and_Gov["2010/"]) 
#kable(Government_table)


total_table <- data.frame(sapply(Government_table, function(x) (x[NROW(x)] - x[1])))
summary_table <- t(total_table)
rownames(summary_table) <- "Change"
kable(summary_table)
```

## Real Government Spending, Percentage of Real GDP

```{r message = FALSE, warning = FALSE, fig.width = 6, fig.height = 3, fig.fullwidth = TRUE, fig.cap = "Real Federal Consumption Expenditure: Percentage of Real GDP"}
Federal_GDP_percent <- 100 * (Real_Federal/Real_GDP)

autoplot(Federal_GDP_percent["1980/"]) +
        ylab("Federal GCE, % GDP") +
        xlab("Year") +
        scale_y_continuous(position = "right") +
        geom_vline(xintercept = c(1990, 1994, 2002, 2010)) +
        theme_bw()
```


## Corporate Profits, Percentage of Real GDP


```{r message = FALSE, warning = FALSE, fig.width = 6, fig.height = 3, fig.fullwidth = TRUE, fig.cap = "Real Federal Consumption Expenditure: Percentage of Real GDP"}

GDP_nom <- "https://fred.stlouisfed.org/data/GDP.txt"
GDP          <- as.xts(read.zoo(GDP_nom, skip = 19, index.column = 1, header = TRUE, 
                       format = "%Y-%m-%d", FUN = as.yearqtr))


### Income Savings ###
Corporate_Profits_After_Tax <- "https://fred.stlouisfed.org/data/CP.txt"
Corporate_Net_Cash_Flow     <- "https://fred.stlouisfed.org/data/CNCF.txt"

### Download 

Corporate_Profits   <-  as.xts(read.zoo(Corporate_Profits_After_Tax, sep = "", skip = 10, 
                           index.column = 1,  header = TRUE, format = "%Y-%m-%d", 
                           FUN = as.yearqtr))
Corporate_Cash_Flow <-  as.xts(read.zoo(Corporate_Net_Cash_Flow, sep = "", skip = 13, 
                           index.column = 1,  header = TRUE, format = "%Y-%m-%d", 
                           FUN = as.yearqtr))     

Corporate_GDP_percent <- 100 * (Corporate_Profits/GDP)

autoplot(Corporate_GDP_percent["2000/"]) +
        ylab("Corporate Profits, % GDP") +
        xlab("Year") +
        scale_y_continuous(position = "right") +
        geom_vline(xintercept = c(2002, 2010)) +
        theme_bw()
```

```{r message = FALSE, warning = FALSE, fig.width = 6, fig.height = 3, fig.fullwidth = TRUE, fig.cap = "Real Federal Consumption Expenditure: Percentage of Real GDP"}

Corporate_Net_Cash_Flow     <- "https://fred.stlouisfed.org/data/CNCF.txt"


Corporate_Cash_Flow <-  as.xts(read.zoo(Corporate_Net_Cash_Flow, sep = "", skip = 13, 
                           index.column = 1,  header = TRUE, format = "%Y-%m-%d", 
                           FUN = as.yearqtr))     

Corp_Cash_GDP_percent <- 100 * (Corporate_Profits/Corporate_Cash_Flow)

autoplot(Corp_Cash_GDP_percent["1982/"]) +
        ylab("Corporate Profits, % of Corporate Cash Flow") +
        xlab("Year") +
        scale_y_continuous(position = "right") +
        geom_vline(xintercept = c(1990, 1994, 2002, 2010)) +
        theme_bw()

```

```{r}

library(Quandl)
SP500_Sales <- Quandl("MULTPL/SP500_REAL_SALES_YEAR", type="xts")
SP500_Earnings <- Quandl("MULTPL/SP500_EARNINGS_YEAR", type="xts")

SP500_Profit <- 100 * (SP500_Earnings-SP500_Sales)

autoplot(SP500_Sales) +
        ylab("S&P 500 Sales Per share") +
        xlab("Year") +
        scale_y_continuous(position = "right") +
        geom_vline(xintercept = c(2002, 2010)) +
        theme_bw()
```

## Productivity



## Raise the Minimum wage

Card and Krueger
```{r, message = FALSE, warning = FALSE, tidy = TRUE}
## Card and Krueger
library(wooldridge)
data("discrim")

#str(discrim)
#lm(discrim$emp ~ discrim$wagest)
#plot(x=discrim$emp, y = discrim$wagest)

ggplot(data=discrim, aes(x=emp, y=wagest)) + 
        geom_point() +
        geom_smooth(method = "lm")

ggplot(data=discrim, aes(y=emp2, x=wagest2)) + 
        geom_point() +
        facet_grid(. ~ state) +
        geom_smooth(method = "lm")

```







